<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[分类：velocity | Blues 小站]]></title>
  <link href="http://www.shenyanchao.cn/blog/categories/velocity/atom.xml" rel="self"/>
  <link href="http://www.shenyanchao.cn/"/>
  <updated>2014-09-02T19:45:01+08:00</updated>
  <id>http://www.shenyanchao.cn/</id>
  <author>
    <name><![CDATA[ShenYanchao]]></name>
    <email><![CDATA[zhiyi.shen@gmail.com]]></email>
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Velocity学习小结]]></title>
    <link href="http://www.shenyanchao.cn/blog/2014/03/31/velocity-study-summary/"/>
    <updated>2014-03-31T16:24:00+08:00</updated>
    <id>http://www.shenyanchao.cn/blog/2014/03/31/velocity-study-summary</id>
    <content type="html"><![CDATA[<h3>velocity在spring项目中的使用</h3>

<p>本文，不是讲velocityResolver来渲染页面的只从最原始的使用方式如何使用。
首先，可以交给Spring来初始化velocityEngine:</p>

<pre><code>&lt;bean id="velocityEngine" class="org.springframework.ui.velocity.VelocityEngineFactoryBean"&gt;
    &lt;property name="configLocation"&gt;
        &lt;value&gt;classpath:velocity.properties&lt;/value&gt;
    &lt;/property&gt;
    &lt;property name="resourceLoaderPath"&gt;
        &lt;value&gt;/WEB-INF/velocity/&lt;/value&gt;
    &lt;/property&gt;
&lt;/bean&gt;
</code></pre>

<p>其中的<code>configLocation</code>指明了velocity的配置文件路径。也就是说一些个性化的配置都可以直接在velocity.properties进行操作了。比如下面的例子：</p>

<pre><code>resource.loader  =  file

file.resource.loader.description =  Velocity  File Resource Loader
file.resource.loader.class = org.apache.velocity.runtime.resource.loader.FileResourceLoader
file.resource.loader.cache =  true
file.resource.loader.modificationCheckInterval =  100

input.encoding = utf-8
output.encoding = utf-8
</code></pre>

<p>需要注意的是，resource.loader可能有多种选择，最常用的是file，class.当然也有webapp,jar等类型。file要求指明具体的路径，而在WEB应用里这块常常就会出现问题。因此，我们倾向于认为从classpath来加载模板。但是，为什么此处仍然推荐使用file而不是class呢。那是因为：</p>

<ul>
<li>spring增强了file加载的能力，推荐使用<code>resourceLoaderPath</code>来指明路径，而不是交给<code>file.resource.loader.path</code>进行处理。如果使用这个可能会跑NullPointerException；</li>
<li>class加载存在弊端，在生产环境classpath里的内容一旦加载就被缓存起来了，这导致velocity模板加载的cache机制失效。</li>
</ul>


<h3>关于Velocity使用的坑</h3>

<ul>
<li><p>关于减号（-）的问题</p>

<blockquote><p>请注意下面的2中写法  <br/>
<code>#set($maxIndex=$DOC_COUNT-1)</code>报错  <br/>
<code>#set($maxIndex=$DOC_COUNT - 1)</code>正确，区别仅在于-两侧的空格</p></blockquote></li>
<li><p>关于Range类型的问题</p>

<blockquote><p><code>#set($array = [0..$maxIndex])</code> 这个里面$maxIndex应该只是一个变量，不能是一个表达式。比如这样<code>#set($array = [0..$maxIndex+1])</code>也是错误的。</p></blockquote></li>
</ul>

]]></content>
  </entry>
  
</feed>
